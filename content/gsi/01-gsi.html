<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>DA-documentation - Intro a GSI</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">DA-documentation</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About this page</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-gsi" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">GSI</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-gsi">    
        <li>
    <a class="dropdown-item" href="../../content/gsi/01-gsi.html" rel="" target="">
 <span class="dropdown-text">How GSI works</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/gsi/02-convencionals.html" rel="" target="">
 <span class="dropdown-text">Assimilation of conventional obs</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/gsi/03-radiances.html" rel="" target="">
 <span class="dropdown-text">Assimilation of radiances</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/gsi/04-diagfiles.html" rel="" target="">
 <span class="dropdown-text">Undestanding diag files</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/gsi/05-tutorial.html" rel="" target="">
 <span class="dropdown-text">Tutorial</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-observations" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Observations</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-observations">    
        <li>
    <a class="dropdown-item" href="../../content/observations/01-bufr.html" rel="" target="">
 <span class="dropdown-text">Working with bufr files</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools ms-auto">
    <a href="https://github.com/paocorrales/DA-documentation" rel="" title="GitHub" class="quarto-navigation-tool px-1" aria-label="GitHub"><i class="bi bi-github"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-gsi-assimilation-system" id="toc-the-gsi-assimilation-system" class="nav-link active" data-scroll-target="#the-gsi-assimilation-system">The GSI assimilation system</a></li>
  <li><a href="#available-observations-for-assimilation" id="toc-available-observations-for-assimilation" class="nav-link" data-scroll-target="#available-observations-for-assimilation">Available observations for assimilation</a>
  <ul class="collapse">
  <li><a href="#conventional-observations-including-satellite-retrievals" id="toc-conventional-observations-including-satellite-retrievals" class="nav-link" data-scroll-target="#conventional-observations-including-satellite-retrievals">Conventional observations (including satellite retrievals):</a></li>
  <li><a href="#satellite-radiancebrightness-temperature-observations-instrumentsatellite-id" id="toc-satellite-radiancebrightness-temperature-observations-instrumentsatellite-id" class="nav-link" data-scroll-target="#satellite-radiancebrightness-temperature-observations-instrumentsatellite-id">Satellite radiance/brightness temperature observations (instrument/satellite ID):</a></li>
  <li><a href="#others" id="toc-others" class="nav-link" data-scroll-target="#others">Others:</a></li>
  </ul></li>
  <li><a href="#running-gsi" id="toc-running-gsi" class="nav-link" data-scroll-target="#running-gsi">Running GSI</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/paocorrales/DA-documentation/edit/main/content/gsi/01-gsi.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/paocorrales/DA-documentation/issues/new/choose" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Intro a GSI</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="the-gsi-assimilation-system" class="level2">
<h2 class="anchored" data-anchor-id="the-gsi-assimilation-system">The GSI assimilation system</h2>
<p>The GSI (Gridpoint Statistical Interpolation) System, is a state-of-the-art data assimilation system initially developed by the Environmental Modeling Center at NCEP. It was designed as a traditional 3DVAR system applied in the gridpoint space of models to facilitate the implementation of inhomogeneous anisotropic covariances <span class="citation" data-cites="wu2002 purser2003a purser2003">[@wu2002; @purser2003a; @purser2003]</span>. It is designed to run on various computational platforms, create analyses for different numerical forecast models, and remain flexible enough to handle future scientific developments, such as the use of new observation types, improved data selection, and new state variables <span class="citation" data-cites="kleist2009">[@kleist2009]</span>.</p>
<p>The- 3DVAR system replaced the NCEP regional grid-point operational analysis system by the North American Mesoscale Prediction System (NAM) in 2006 and the <em>Spectral Statistical Interpolation</em> (SSI) global analysis system used to generate <em>Global Forecast System</em> (GFS) initial conditions in 2007 <span class="citation" data-cites="kleist2009">[@kleist2009]</span>. In recent years, GSI has evolved to include various data assimilation techniques for multiple operational applications, including 2DVAR [e.g., the <em>Real-Time Mesoscale Analysis</em> (RTMA) system; <span class="citation" data-cites="pondeca2011">@pondeca2011</span>], the hybrid EnVar technique (e.g., data assimilation systems for the GFS, the <em>Rapid Refresh system</em> (RAP), the NAM, the HWRF, etc. ), and 4DVAR [e.g., the data assimilation system for NASA’s Goddard Earth Observing System, version 5 (GEOS-5); <span class="citation" data-cites="zhu2008">@zhu2008</span>]. GSI also includes a hybrid 4D-EnVar approach that is currently used for GFS generation.</p>
<p>In addition to the development of hybrid techniques, GSI allows the use of ensemble assimilation methods. To achieve this, it uses the same observation operator as the variational methods to compare the preliminary field or background with the observations. In this way the exhaustive quality controls developed for variational methods are also applied in ensemble assimilation methods. The EnKF code was developed by the Earth System Research Lab (ESRL) of the National Oceanic and Atmospheric Administration (NOAA) in collaboration with the scientific community. It contains two different algorithms for calculating the analysis increment, the serial Ensemble Square Root Filter <span class="citation" data-cites="whitaker2002">[EnSRF, @whitaker2002]</span> and the LETKF <span class="citation" data-cites="hunt2007">[@hunt2007]</span> contributed by Yoichiro Ota of the Japan Meteorological Agency (JMA).</p>
<p>To reduce the impact of spurious covariances on the increment applied to the analysis, ensemble systems apply a localization to the covariance matrix of the errors of the observations <span class="math inline">\(R\)</span> in both the horizontal and vertical directions. GSI uses a polynomial of order 5 to reduce the impact of each observation gradually until a limiting distance is reached at which the impact is zero. The vertical location scale is defined in terms of the logarithm of the pressure and the horizontal scale is usually defined in kilometers. These parameters are important in obtaining a good analysis and depend on factors such as the size of the ensemble and the resolution of the model.</p>
<p>GSI uses the Community Radiative Transfer Model <span class="citation" data-cites="liu2008">[CRTM, @liu2008]</span> as an operator for the radiance observations that calculates the brightness temperature simulated by the model in order to compare it with satellite sensor observations. GSI also implements a bias correction algorithm for the satellite radiance observations. The preliminary field estimate with the CRMT is compared with the radiance observations to obtain the innovation. This innovation is then used to calculate a bias that is applied to an updated innovation. This process can be repeated several times until the innovation and the bias correction coefficients converge.</p>
</section>
<section id="available-observations-for-assimilation" class="level2">
<h2 class="anchored" data-anchor-id="available-observations-for-assimilation">Available observations for assimilation</h2>
<p>Here is the list of observations that can be assimilated by GSI. In bold are the observations for with I have experience and/or the ones <a href="https://github.com/paocorrales/comGSIv3.7_EnKFv1.3">I’ve adapted the code for it</a>.</p>
<section id="conventional-observations-including-satellite-retrievals" class="level3">
<h3 class="anchored" data-anchor-id="conventional-observations-including-satellite-retrievals">Conventional observations (including satellite retrievals):</h3>
<ul>
<li><strong>Radiosondes</strong></li>
<li>Pilot ballon (PIBAL) winds</li>
<li>Synthetic tropical cyclone winds</li>
<li>Wind profilers: USA, Jan Meteorological Agency (JMA)</li>
<li><strong>Conventional aircraft reports</strong></li>
<li>Aircraft to Satellite Data Relay (ASDAR) aircraft reports</li>
<li>Meteorological Data Collection and Reporting System (MDCRS) aircraft reports</li>
<li>Dropsondes</li>
<li><strong>Moderate Resolution Imaging Spectroradiometer (MODIS) IR and water vapor winds</strong></li>
<li><strong>Geostationary Meteorological Satellite (GMS), JMA, and Meteosat cloud drift IR and visible winds</strong></li>
<li><strong>European Organization for the Exploitation of Meteorological Satellites (EUMETSAT) and GOES water vapor cloud top winds</strong></li>
<li>GEOS hourly IR and cloud top wind</li>
<li><strong>Surface land observations</strong></li>
<li>Surface ship and buoy observations</li>
<li>Special Sensor Microwave Imager (SSMI) wind speeds</li>
<li>Quick Scatterometer (QuikSCAT), the Advanced Scatterometer (ASCAT) and Oceansat-2 Scatterometer (OSCAT) wind speed and direction</li>
<li>RapidScat observations</li>
<li>SSM/I and Tropical Rainfall Measuring Mission (TRMM) Microwave Imager (TMI) precipitation estimates</li>
<li>Velocity-Azimuth Display (VAD) Next Generation Weather Radar ((NEXRAD) winds</li>
<li>Global Positioning System (GPS) precipitable water estimates Sea surface temperatures (SSTs)</li>
<li>Doppler wind Lidar</li>
<li>Aviation routine weather report (METAR) cloud coverage</li>
<li>Flight level and Stepped Frequency Microwave Radiometer (SFMR) High Density Observation (HDOB) from reconnaissance aircraft</li>
<li>Tall tower wind</li>
</ul>
</section>
<section id="satellite-radiancebrightness-temperature-observations-instrumentsatellite-id" class="level3">
<h3 class="anchored" data-anchor-id="satellite-radiancebrightness-temperature-observations-instrumentsatellite-id">Satellite radiance/brightness temperature observations (instrument/satellite ID):</h3>
<ul>
<li>SBUV: NOAA-17, NOAA-18, NOAA-19</li>
<li><strong>High Resolution Infrared Radiation Sounder (HIRS): Meteorological Operational-A(MetOp-A), MetOp-B, NOAA-17, NOAA-19</strong></li>
<li>GOES imager: GOES-11, GOES-12</li>
<li><strong>Atmospheric IR Sounder (AIRS): aqua</strong></li>
<li><strong>AMSU-A: MetOp-A, MetOp-B, NOAA-15, NOAA-18, NOAA-19, aqua</strong></li>
<li><strong>AMSU-B: MetOp-B, NOAA-17</strong></li>
<li><strong>Microwave Humidity Sounder (MHS): MetOp-A, MetOp-B, NOAA-18, NOAA-19</strong></li>
<li>SSMI: DMSP F14, F15, F19</li>
<li>SSMI/S: DMSP F16</li>
<li>Advanced Microwave Scanning Radiometer for Earth Observing System (AMSR-E): aqua</li>
<li>GOES Sounder (SNDR): GOES-11, GOES-12, GOES-13</li>
<li><strong>Infrared Atmospheric Sounding Interferometer (IASI): MetOp-A, MetOp-B</strong></li>
<li>Global Ozone Monitoring Experiment (GOME): MetOp-A, MetOp-B</li>
<li>Ozone Monitoring Instrument (OMI): aura</li>
<li>Spinning Enhanced Visible and Infrared Imager (SEVIRI): Meteosat-8, Meteosat-9, Meteosat-10</li>
<li>Advanced Technology Microwave Sounder (ATMS): Suomi NPP</li>
<li>Cross-track Infrared Sounder (CrIS): Suomi NPP</li>
<li>GCOM-W1 AMSR2</li>
<li>GPM GMI</li>
<li>Megha-Tropiques SAPHIR</li>
<li>Himawari AHI</li>
<li><strong>GOES ABI</strong></li>
</ul>
</section>
<section id="others" class="level3">
<h3 class="anchored" data-anchor-id="others">Others:</h3>
<ul>
<li>GPS Radio occultation (RO) refractivity and bending angle profiles</li>
<li>Solar Backscatter Ultraviolet (SBUV) ozone profiles, Microwave Limb Sounder (MLS) (including NRT) ozone, * and Ozone Monitoring Instrument (OMI) total ozone</li>
<li>Doppler radar radial velocities radar reflectivity Mosaic</li>
<li>Tail Doppler Radar (TDR) radial velocity and super-observation</li>
<li>Tropical Cyclone Vitals Database (TCVital)</li>
<li>Particulate matter (PM) of 10-um diameter, 2.5-um diameter or less</li>
<li>MODIS AOD (when using GSI-chem package)</li>
<li>Significant wave height observations from JASON-2, JASON-3, SARAL/ALTIKA and CRYOSAT-2</li>
</ul>
</section>
</section>
<section id="running-gsi" class="level2">
<h2 class="anchored" data-anchor-id="running-gsi">Running GSI</h2>
<p>Every assimilation cycle starts with the background, a forecast generated using a numerical model (WRF-ARW for this guide), that was initialized from previous analysis and observations (in bufr format) that enters the GSI system. GSI will also need “fixed” files with information about the observations. This files define which observations are going to be assimilated, they errors and quality control options.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/cycle_diagram.png" class="img-fluid figure-img" alt="Diagram that shows a cycle. First the background (forecasts generated using a numerical model, WRF-ARW, initialized from previous analysis) and Observations (from bufr files) enters the GSI system. Inside the system, the Observation Operator takes care of the quality control and bias correction and then calculates the innovation and generates the diag files. Then the ENKF part calculates the update appling the innovation to the background to generate the analysis. The analysis is used to create a new background to star the cycle again"></p>
<figcaption class="figure-caption">Diagram of an assimilation cycle</figcaption>
</figure>
</div>
<p>GSI can also be used with the following background files:</p>
<ul>
<li>WRF-NMM input fields in binary format</li>
<li>WRF-NMM input fields in NetCDF format</li>
<li>WRF-ARW input fields in binary format</li>
<li><strong>WRF-ARW input fields in NetCDF format</strong></li>
<li>GFS input fields in binary format or through NEMS I/O</li>
<li>NEMS-NMMB input fields</li>
<li>RTMA input files (2-dimensional binary format)</li>
<li>WRF-Chem GOCART input fields with NetCDF format</li>
<li>CMAQ binary file</li>
</ul>
<p>And the official tutorials are a good starting point to grasp the use of this options.</p>
<p>GSI can also be run <em>without observations</em> to test the code, this is with a single synthetic observation defined in the SINGLEOB_TEST section in the namelist.</p>
<p>The fixed files are located in the <code>fix/</code> folder and includes statistic files, configuration files, bias correction files, and CRTM coefficient files<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. The information of the configuration files is saved in the output files after running GSI.</p>
<table class="table">
<colgroup>
<col style="width: 31%">
<col style="width: 36%">
<col style="width: 31%">
</colgroup>
<thead>
<tr class="header">
<th>GSI Name</th>
<th>Content</th>
<th>File names</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>anavinfo</td>
<td>Information file to set control and analysis variables</td>
<td>anavinfo_arw_netcdf</td>
</tr>
<tr class="even">
<td>berror_stats</td>
<td>background error covariance (for variacional methods)</td>
<td>nam_nmmstat_na.gcv, nam_glb_berror.f77.gcv,</td>
</tr>
<tr class="odd">
<td>errtable</td>
<td>Observation error table</td>
<td>prepobs_errtable.global</td>
</tr>
<tr class="even">
<td>convinfo</td>
<td>Conventional observation information file</td>
<td>global_convinfo.txt</td>
</tr>
<tr class="odd">
<td>satinfo</td>
<td>satellite channel information file</td>
<td>global_satinfo.txt</td>
</tr>
<tr class="even">
<td>pcpinfo</td>
<td>precipitation rate observation information file</td>
<td>global_pcpinfo.txt</td>
</tr>
<tr class="odd">
<td>ozinfo</td>
<td>ozone observation information file</td>
<td>global_ozinfo.txt</td>
</tr>
<tr class="even">
<td>satbias_angle</td>
<td>satellite scan angle dependent bias correction file</td>
<td>global_satangbias.txt</td>
</tr>
<tr class="odd">
<td>satbias_in</td>
<td>satellite mass bias correction coefficient file</td>
<td>sample.satbias</td>
</tr>
<tr class="even">
<td>satbias_in</td>
<td>combined satellite angle dependent and mass bias correction coefficient file</td>
<td>gdas1.t00z.abias.new</td>
</tr>
</tbody>
</table>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>This files need to be downloaded separately as they are to big to be part of the GSI repository. Also the coefficient files can be updated with better approximations over time.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="../../about.html">About</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="../../license.html">License</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="../../contribute.html">Contribute</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="../../contributors.html">Contributors</a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/paocorrales/DA-documentation">
      <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



</body></html>